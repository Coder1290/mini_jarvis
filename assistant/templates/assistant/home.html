<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Jarvis Web</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #log { margin-top: 1rem; padding: 1rem; border: 1px solid #ccc; height: 200px; overflow-y: auto; }
    .user { color: blue; }
    .jarvis { color: green; }
    button { margin-left: 0.5rem; }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Mini Jarvis Web</h1>
  <input id="commandInput" type="text" placeholder="Type a command..." size="40">
  <button onclick="sendCommand()">Send</button>
  <button onclick="startListening()">ðŸŽ¤ Speak</button>

  <div id="log"></div>

  <script>
    async function sendCommand(cmdOverride=null) {
      const input = document.getElementById("commandInput");
      const cmd = cmdOverride || input.value.trim();
      if (!cmd) return;

      logMessage("You: " + cmd, "user");

      const res = await fetch("/assistant/command/", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({command: cmd})
      });
      const data = await res.json();
      const response = data.response;

      logMessage("Jarvis: " + response, "jarvis");

      // Browser speaks the response
      const utterance = new SpeechSynthesisUtterance(response);
      speechSynthesis.speak(utterance);

      input.value = "";
    }

    function logMessage(msg, cls) {
      const log = document.getElementById("log");
      const div = document.createElement("div");
      div.className = cls;
      div.textContent = msg;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    // ðŸŽ¤ Microphone input using Web Speech API
    function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Speech recognition not supported in this browser. Try Chrome.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => logMessage("ðŸŽ¤ Listening...", "user");
      recognition.onerror = (event) => logMessage("Error: " + event.error, "user");
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        sendCommand(transcript);
      };

      recognition.start();
    }
  </script>
</body>
</html>